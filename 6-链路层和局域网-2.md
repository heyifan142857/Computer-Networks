### **链路层与局域网-2**  
---

#### **1. 以太网（Ethernet）核心技术**  
**核心特性**：  
- **帧结构**：  
  ```plaintext
  | 前导码 (7B) | 帧开始符 (1B) | 目标MAC (6B) | 源MAC (6B) | 类型 (2B) | 数据 (46-1500B) | CRC (4B) |
  ```
  - **类型字段**：标识上层协议（如`0x0800`=IPv4，`0x0806`=ARP）。  
  - **无连接不可靠传输**：依赖上层协议（如TCP）保障可靠性。  

**物理拓扑演进**：  
- **传统总线型**：所有节点共享冲突域（CSMA/CD）。  
- **现代交换型**：交换机为中心，全双工通信，无冲突。  

**速率发展**：10 Mbps → 400 Gbps（如Broadcom BCM5761多速率芯片）。  

---

#### **2. 以太网交换机工作原理**  
**核心功能**：  
- **自学习（Self-Learning）**：  
  1. 记录源MAC与入端口的映射（如`MAC=A, Interface=1, TTL=60s`）。  
  2. 更新转发表，过期条目自动删除。  
- **帧转发策略**：  
  - **已知目标MAC**：定向转发到对应端口。  
  - **未知目标MAC**：泛洪（Flooding）至所有非接收端口。  

**示例**：  
```plaintext
交换机转发表：
| MAC地址       | 端口 | TTL  |
|---------------|------|------|
| 74-29-9C-E8-FF-55 | 1    | 60   |
| E6-E9-00-17-BB-4B | 4    | 60   |
```
- **多交换机互联**：通过泛洪与自学习实现跨交换机通信（无需配置）。  

---

#### **3. 虚拟局域网（VLAN）**  
**核心机制**：  
- **端口划分**：将物理交换机逻辑划分为多个虚拟交换机（如端口1-8属VLAN 10，9-15属VLAN 20）。  
- **Trunk端口**：跨交换机传输VLAN帧时携带VLAN ID（802.1Q协议）。  
  ```plaintext
  | 目标MAC | 源MAC | 802.1Q标签 (4B) | 类型 | 数据 | CRC |
  ```  
  - **标签字段**：12位VLAN ID（如`VLAN 10`）。  

**优势**：  
- **流量隔离**：限制广播域范围，提升安全性。  
- **灵活配置**：动态调整端口所属VLAN。  

---

#### **4. 多协议标签交换（MPLS）**  
**核心思想**：  
- **标签转发**：替代IP最长前缀匹配，提升速度。  
  ```plaintext
  | 标签 (20b) | Exp (3b) | S (1b) | TTL (8b) |
  ```  
- **应用场景**：  
  - **流量工程**：基于源/目标IP选择不同路径。  
  - **快速重路由**：预计算备份路径应对链路故障。  

**示例**：  
```plaintext
MPLS转发表（R4）：
| 入标签 | 出标签 | 目标 | 出接口 |
|--------|--------|------|--------|
| 6      | -      | A    | 0      |
| 10     | 6      | A    | 1      |
```

---

#### **5. 数据中心网络架构**  
**核心组件**：  
- **服务器机架**：20-40台服务器 + **TOR交换机**（Top of Rack）。  
- **多层交换**：  
  - **Tier-2**：连接16+ TOR交换机。  
  - **Tier-1**：连接16+ Tier-2交换机。  
- **负载均衡**：应用层路由（如DNS轮询、Anycast）。  

**协议创新**：  
- **RDMA over Ethernet（RoCE）**：绕过内核协议栈，直接内存访问。  
- **显式拥塞通知（ECN）**：用于DCTCP等数据中心专用传输协议。  

---

#### **6. 综合示例：网页请求全流程**  
1. **DHCP获取IP**：  
   - 客户端广播DHCP请求 → 服务器回复IP、DNS、网关信息。  
2. **ARP解析网关MAC**：  
   - 广播ARP请求 → 网关回复MAC地址。  
3. **DNS查询**：  
   - 封装DNS查询至UDP/IP → 经路由器转发至DNS服务器。  
4. **TCP连接建立**：  
   - 发送SYN至目标IP → 服务器回复SYN-ACK。  
5. **HTTP请求/响应**：  
   - 发送HTTP GET → 服务器返回网页内容。  
