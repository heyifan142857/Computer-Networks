### **网络层（控制平面）-2**  
---

#### **1. BGP（边界网关协议）**  
**核心功能**：  
- **eBGP**：AS间路由通告（如AS3向AS2宣告路径`AS3,X`）。  
- **iBGP**：AS内部传播可达性信息（确保所有路由器知晓外部路由）。  

**路径属性**：  
- **AS-PATH**：记录路径经过的AS序列（防环，如`AS2,AS3,X`）。  
- **NEXT-HOP**：指定下一跳AS的内部路由器IP。  

**路由选择策略**：  
1. **本地优先级**（Local Pref）：管理员手动设置（如优先选择某供应商）。  
2. **最短AS-PATH**：减少跨AS跳数。  
3. **热土豆路由**（Hot Potato）：选择AS内成本最低的出口路由器。  

**示例**：  
```
AS1从AS2和AS3均收到到X的路由：
- AS2路径：AS2,AS3,X（AS-PATH长度=2）
- AS3路径：AS3,X（AS-PATH长度=1）
选择AS3路径（更短AS-PATH）。
```

---

#### **2. SDN控制平面架构**  
**三大核心组件**：  
1. **数据平面交换机**：  
   - 仅执行流表匹配动作（如OpenFlow交换机）。  
   - 无控制逻辑，依赖控制器下发流表。  

2. **SDN控制器**（网络操作系统）：  
   - **北向API**：为应用提供抽象接口（如RESTful API）。  
   - **南向API**：控制交换机（如OpenFlow协议）。  
   - **网络状态管理**：维护全局拓扑、流量统计等。  

3. **网络控制应用**：  
   - 路由、负载均衡、防火墙等逻辑，通过控制器API实现。  

**SDN体系结构的4个关键特征**  
1. **控制与数据平面分离**：交换机仅转发，控制器集中决策。  
2. **网络可编程性**：通过API动态定义流量行为（如OpenFlow流表）。  
3. **集中式网络控制逻辑**：控制器维护全网状态（拓扑、流量）。  
4. **标准化接口**：  
   - **南向API**（如OpenFlow）：控制器管理交换机。  
   - **北向API**（如REST）：应用调用网络服务。  

**OpenFlow关键消息**：  
| **消息类型**         | **方向**            | **作用**                          |  
|-----------------------|---------------------|-----------------------------------|  
| `packet-in`           | 交换机 → 控制器     | 上报无法匹配的包                  |  
| `flow-mod`            | 控制器 → 交换机     | 安装/删除流表项                   |  
| `port-status`         | 交换机 → 控制器     | 通知端口状态变化（如链路故障）    |  

**SDN优势**：  
- **集中控制**：灵活流量工程（如指定`u→z`走`uvwz`路径）。  
- **解耦创新**：第三方应用可编程网络行为（如自定义负载均衡）。  

---

#### **3. ICMP（互联网控制报文协议）**  
**功能**：  
- **错误报告**：类型3代码3表示“端口不可达”。  
- **诊断工具**：`ping`（类型8/0）、`traceroute`（利用TTL超时，类型11）。  

**Traceroute原理**：  
1. 发送TTL=1的UDP包，第一跳路由器回复ICMP超时（类型11）。  
2. 逐步增加TTL，记录每跳路由器IP及RTT。  
3. 目标主机返回“端口不可达”（类型3），终止探测。  

**报文格式**：  
- **头部**：类型（8位）、代码（8位）、校验和（16位）。  
- **数据**：包含触发错误的IP包前8字节。  

---

#### **4. 网络管理协议对比**  
| **协议**   | **特点**                                  | **应用场景**               |  
|------------|-------------------------------------------|----------------------------|  
| **SNMP**   | 简单查询/设置MIB变量，UDP传输             | 设备监控（如端口流量统计） |  
| **NETCONF**| 基于XML的RPC，支持事务性配置（如原子提交）| 多设备批量配置管理         |  
| **YANG**   | 数据建模语言，定义NETCONF数据结构         | 配置模板生成与验证         |  

#### **5. SNMP（简单网络管理协议）**  
**操作类型**：  
| **操作**        | **功能**                                |  
|-----------------|----------------------------------------|  
| `GetRequest`    | 查询MIB变量（如端口流量）              |  
| `SetRequest`    | 修改配置（如关闭端口）                 |  
| `Trap`          | 设备主动上报事件（如链路故障）         |  

**SNMP操作示例**：  
```xml
<GetRequest>
    <ObjectID>1.3.6.1.2.1.7.1</ObjectID>  <!-- UDP输入数据报计数 -->
</GetRequest>
```